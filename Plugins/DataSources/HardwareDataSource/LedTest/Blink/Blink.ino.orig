//#define DEBUG
#ifdef DEBUG
int fade;
#endif

<<<<<<< HEAD
#define PIN_OUT_1 9
#define PIN_OUT_2 10
#define PIN_OUT_3 11
#define PIN_IN_1 A0
#define PIN_IN_2 A1
#define PIN_IN_3 A2

int activePinId;
=======
#define PIN_IN_1 9
#define PIN_IN_2 10
#define PIN_IN_3 11
#define PIN_OUT_1 A0
#define PIN_OUT_2 A1
#define PIN_OUT_3 A2

int activeInPinId;
int activeOutPinId;
>>>>>>> develop
bool readMode;
int delayTime;

void setup() 
{
  pinMode(9, OUTPUT);
  pinMode(10, OUTPUT);
<<<<<<< HEAD
  activePinId = PIN_IN_1;
  readMode = false;
  delayTime = 1000;
  Serial.begin(9600);
  
=======
  pinMode(11, OUTPUT);
  activeInPinId = PIN_IN_1;
  activeOutPinId = PIN_OUT_1;
  readMode = false;
  delayTime = 1000;
  Serial.begin(9600);
  Serial.flush();
>>>>>>> develop
#ifdef DEBUG
  Serial.print("Init");
  fade = 0;
#endif
}

void loop() 
{
//#ifdef DEBUG
//  fade = fade < 255 ? fade+1 : 0;
//  analogWrite(9, fade);
//  delay(5);
//  return;
//#endif
  
  if(readMode)
  {
      ReadPin();
  }
<<<<<<< HEAD

  if(!Serial.available())
    return;
=======
  
  if(!Serial.available())
    return;
#ifdef DEBUG
  Serial.print(Serial.available());
#endif
>>>>>>> develop
  ResolveMessage();
  return;
}

void ResolveMessage()
{
  char mode = Serial.read();
  switch(mode)
  {
    // Sets active pin.
<<<<<<< HEAD
    case 'i': GetPinsInfo(); break;
    case 's': SetActivePin(); break;
    case 'd': SetDelay(); break;
    case 'w': WritePin(); break;
    case 'r': ReadPin();
    default: Serial.print("Cant resolve mode"); return;
=======
    case 's': GetPinsInfo(); break;
    case 'i': SetActiveInPin(); break;
    case 'o': SetActiveOutPin(); break;
    case 'd': SetDelay(); break;
    case 'w': WritePin(); break;
    case 'r': ReadPin();
    default:  return;
>>>>>>> develop
  }
}

void GetPinsInfo()
{
  StartSerial('i');
  PrintSerial(PIN_IN_1);
  PrintSerial(PIN_IN_2);
  PrintSerial(PIN_IN_3);
  PrintSerial('o');
  PrintSerial(PIN_OUT_1);
  PrintSerial(PIN_OUT_2);
  PrintSerial(PIN_OUT_3);
  EndSerial();
}

<<<<<<< HEAD
void SetActivePin()
{
  activePinId = Serial.parseInt();
=======
void SetActiveInPin()
{
  activeInPinId = Serial.parseInt();
  return;
}

void SetActiveOutPin()
{
  int newActivePin = Serial.parseInt();
  if(activeOutPinId == newActivePin) 
    readMode = !readMode;
  else 
    readMode = true;
  activeOutPinId = newActivePin;
  return;
>>>>>>> develop
}

void SetDelay()
{
  delayTime = Serial.parseInt();
}

void WritePin()
{
  int writeValue = Serial.parseInt();
<<<<<<< HEAD
  
#ifdef DEBUG
  Serial.print("WritePin ");
  Serial.print(activePinId);
  Serial.print(' ');
  Serial.println(writeValue);
#endif
  analogWrite(activePinId, writeValue);
=======
  analogWrite(activeInPinId, writeValue);
>>>>>>> develop
}

void ReadPin()
{
<<<<<<< HEAD
  readMode = true;
  int readValue = analogRead(A0);
#ifdef DEBUG
  Serial.print("ReadPin ");
  Serial.print(activePinId);
  Serial.print(' ');
  Serial.println(readValue);
#endif
  StartSerial('r');
  PrintSerial(readValue);
  EndSerial();
=======
  int readValue = analogRead(activeOutPinId);
  StartSerial('r');
  PrintSerial(readValue);
  EndSerial();
  delay(delayTime);
>>>>>>> develop
}

void StartSerial(char letter)
{
  Serial.print('{');
  Serial.print(letter);
}

void PrintSerial(char letter)
{
  Serial.print(',');
  Serial.print(letter);
}

void PrintSerial(int value)
{
  Serial.print(',');
  Serial.print(value);
}

void EndSerial()
{
  Serial.print('}');
  Serial.flush();
<<<<<<< HEAD
  delay(delayTime);
=======
}

void ErrorSerial(char str[])
{
  Serial.print("Error-");
  Serial.print(str);
  Serial.flush();
>>>>>>> develop
}


